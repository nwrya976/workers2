<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“‹ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ø¹Ù…Ø§Ù„</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body { 
        font-family: 'Cairo', sans-serif;
        direction: rtl; 
        background: linear-gradient(135deg, #1f1f2e, #12121c);
        color: #e0e0e0;
        padding: 20px; 
        min-height: 100vh;
        transition: background 0.5s ease, color 0.5s ease;
    }
    
    /* Light Mode */
    body.light-mode {
        background: #f0f0f0;
        color: #111;
    }
    
    body.light-mode .container {
        background: #ffffff;
        border: 1px solid #ccc;
        color: #111;
    }
    
    body.light-mode h1, body.light-mode h2, body.light-mode h3 {
        color: #2193b0;
        -webkit-text-fill-color: #2193b0;
    }
    
    body.light-mode button {
        background: linear-gradient(135deg, #00b09b, #96c93d);
        color: #fff;
    }
    
    body.light-mode input, body.light-mode textarea, body.light-mode select {
        background-color: #fff;
        color: #000;
        border-color: #bbb;
    }
    
    body.light-mode th {
        background: #f8f9fa;
        color: #333;
    }
    
    body.light-mode td {
        color: #333;
    }
    
    /* Theme Toggle */
    .theme-toggle {
        background: none;
        color: #e0e0e0;
        font-size: 1.5rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: none;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        transition: color 0.3s, background 0.3s;
    }
    
    body.light-mode .theme-toggle {
        color: #2c3e50;
    }
    
    .container { 
        max-width: 900px;
        margin: auto; 
        background: rgba(40, 44, 52, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(6px);
        padding: 40px 35px;
        border-radius: 20px; 
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
        transition: transform 0.4s ease, box-shadow 0.4s ease;
        animation: fadeInUp 0.6s ease-out;
        margin-top: 80px;
    }
    
    .container:hover {
        transform: scale(1.005);
        box-shadow: 0 14px 40px rgba(0, 0, 0, 0.5);
    }

    h1, h2, h3 { 
        text-align: center;
        color: #ffffff;
        background: linear-gradient(to right, #6dd5ed, #2193b0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 20px;
    }
    
    h1 {
        font-size: 36px;
        margin-bottom: 25px;
    }

    /* Styles for Inputs */
    input[type="text"], input[type="number"], input[type="email"], input[type="password"], 
    input[type="file"], select, textarea { 
        margin: 5px 0;
        padding: 12px; 
        width: 100%; 
        border: 1px solid #444; 
        border-radius: 10px; 
        box-sizing: border-box;
        background-color: #1d1f27;
        color: #fff;
        font-size: 1rem;
    }
    
    input:focus, textarea:focus, select:focus {
        border-color: #6dd5ed;
        outline: none;
    }

    /* Styles for Buttons */
    button { 
        background: linear-gradient(135deg, #00b09b, #96c93d);
        color: #fff;
        cursor: pointer; 
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 5px 16px rgba(0, 255, 180, 0.3);
        margin: 5px 0;
        padding: 12px;
        width: 100%;
        border: none;
        border-radius: 10px;
        box-sizing: border-box;
        font-size: 1rem;
    }
    
    button:hover {
        background: linear-gradient(135deg, #00816a, #7db515);
        box-shadow: 0 8px 22px rgba(0, 255, 180, 0.4);
        transform: translateY(-1px);
    }
    
    button.delete {
        background: #e74c3c;
        box-shadow: 0 5px 16px rgba(231, 76, 60, 0.3);
    }
    
    button.delete:hover {
        background: #c0392b;
        box-shadow: 0 8px 22px rgba(231, 76, 60, 0.4);
    }

    /* New Button Styles */
    button.back-btn {
        background: linear-gradient(135deg, #8e44ad, #6c3483);
        box-shadow: 0 5px 16px rgba(142, 68, 173, 0.3);
    }
    
    button.back-btn:hover {
        background: linear-gradient(135deg, #7d3c98, #5b2c6f);
        box-shadow: 0 8px 22px rgba(142, 68, 173, 0.4);
    }

    button.share-btn {
        background: linear-gradient(135deg, #3498db, #2980b9);
        box-shadow: 0 5px 16px rgba(52, 152, 219, 0.3);
    }
    
    button.share-btn:hover {
        background: linear-gradient(135deg, #2980b9, #1f6394);
        box-shadow: 0 8px 22px rgba(52, 152, 219, 0.4);
    }

    table { 
        width: 100%; 
        border-collapse: collapse;
        margin-top: 15px; 
    }
    
    th, td { 
        border: 1px solid #444;
        padding: 10px; 
        text-align: center; 
    }
    
    th { 
        background: #1d1f27;
        color: #e0e0e0;
    }

    .report { 
        margin-top: 20px;
        padding: 15px; 
        background: rgba(40, 44, 52, 0.95); 
        border: 1px solid rgba(255, 255, 255, 0.05); 
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    body.light-mode .report {
        background: #f8f9fa;
        color: #333;
        border: 1px solid #ddd;
    }

    .worker-image { 
        width: 50px;
        height: 50px; 
        border-radius: 50%; 
        object-fit: cover; 
        cursor: pointer; 
    }
    
    .worker-details { 
        display: flex;
        align-items: center; 
        justify-content: center; 
    }
    
    .worker-details img { 
        margin-left: 10px;
    }

    .action-buttons { 
        display: flex; 
        flex-direction: column; 
        align-items: center;
        gap: 5px; 
    }
    
    .inline-buttons { 
        display: flex;
        gap: 5px; 
    }
    
    .inline-buttons button { 
        width: auto;
    }

    /* Project Card Styles */
    .project-card {
        background: rgba(40, 44, 52, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin: 15px 0;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    body.light-mode .project-card {
        background: #ffffff;
        border: 1px solid #ddd;
        color: #333;
    }

    .project-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        border-color: #6dd5ed;
    }

    .project-card h3 {
        margin: 0;
        color: #6dd5ed;
        font-size: 1.3rem;
    }

    .project-info {
        margin-top: 10px;
        font-size: 0.9rem;
        opacity: 0.8;
    }

    /* New Project Input Section */
    .add-project-section {
        background: rgba(40, 44, 52, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        display: none;
    }

    body.light-mode .add-project-section {
        background: #ffffff;
        border: 1px solid #ddd;
    }

    .add-project-section.show {
        display: block;
        animation: slideDown 0.3s ease;
    }

    /* Project Details Header */
    .project-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .project-header h2 {
        margin: 0;
        flex: 1;
    }

    .project-header-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .project-header-buttons button {
        width: auto;
        padding: 10px 20px;
        margin: 0;
        font-size: 0.9rem;
    }

    /* Modal styles */
    .modal { 
        display: none;
        position: fixed; 
        z-index: 1000; 
        padding-top: 100px; 
        left: 0; 
        top: 0; 
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.9);
    }
    
    .modal-content { 
        margin: auto;
        display: block; 
        width: 80%; 
        max-width: 700px; 
    }
    
    .modal-content, #caption { 
        animation-name: zoom;
        animation-duration: 0.6s; 
    }
    
    .close { 
        position: absolute;
        top: 15px; 
        right: 35px; 
        color: #f1f1f1; 
        font-size: 40px; 
        font-weight: bold; 
        transition: 0.3s;
    }
    
    .close:hover, .close:focus { 
        color: #bbb;
        text-decoration: none; 
        cursor: pointer; 
    }

    /* Share Modal */
    .share-modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
    }

    .share-modal-content {
        background-color: rgba(40, 44, 52, 0.95);
        margin: 15% auto;
        padding: 30px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        width: 80%;
        max-width: 500px;
        text-align: center;
        backdrop-filter: blur(6px);
    }

    body.light-mode .share-modal-content {
        background-color: #ffffff;
        border: 1px solid #ddd;
        color: #333;
    }

    .share-link {
        background: #1d1f27;
        color: #6dd5ed;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
        word-break: break-all;
        border: 1px solid #6dd5ed;
        font-family: monospace;
    }

    body.light-mode .share-link {
        background: #f8f9fa;
        color: #2193b0;
        border-color: #2193b0;
    }
    
    @keyframes zoom { 
        from { transform:scale(0) } 
        to { transform:scale(1) } 
    }
    
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Auth Page Styles */
    .auth-container {
        background: rgba(40, 44, 52, 0.95);
        backdrop-filter: blur(6px);
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        width: 100%;
        max-width: 400px;
        text-align: center;
        color: #e0e0e0;
        margin: 80px auto 0;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    body.light-mode .auth-container {
        background: white;
        color: #333;
        border: 1px solid #ccc;
    }
    
    .auth-container h1 {
        color: #ffffff;
        background: linear-gradient(to right, #6dd5ed, #2193b0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 2rem;
        font-size: 1.8rem;
    }
    
    body.light-mode .auth-container h1 {
        color: #333;
        background: none;
        -webkit-text-fill-color: #333;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
        text-align: right;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #e0e0e0;
        font-weight: 500;
    }
    
    body.light-mode .form-group label {
        color: #555;
    }
    
    .form-group input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #444;
        border-radius: 10px;
        font-size: 1rem;
        transition: border-color 0.3s;
        text-align: right;
        background: #1d1f27;
        color: #fff;
    }
    
    body.light-mode .form-group input {
        background: white;
        color: #333;
        border: 2px solid #ddd;
    }
    
    .form-group input:focus {
        outline: none;
        border-color: #6dd5ed;
        box-shadow: 0 0 0 3px rgba(109, 213, 237, 0.1);
    }
    
    .button-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 2rem;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #00b09b, #96c93d);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 5px 16px rgba(0, 255, 180, 0.3);
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #00816a, #7db515);
        transform: translateY(-2px);
    }
    
    .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #e0e0e0;
        border: 2px solid rgba(255, 255, 255, 0.2);
        padding: 12px 20px;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    body.light-mode .btn-secondary {
        background: #f7f7f7;
        color: #333;
        border: 2px solid #ddd;
    }
    
    .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
    }
    
    body.light-mode .btn-secondary:hover {
        background: #e7e7e7;
    }
    
    .success-message {
        display: none;
        background: #d4edda;
        color: #155724;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        border: 1px solid #c3e6cb;
    }
    
    .error-message {
        display: none;
        background: #f8d7da;
        color: #721c24;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        border: 1px solid #f5c6cb;
    }
    
    .form-toggle {
        margin-top: 1rem;
        color: #ccc;
    }
    
    body.light-mode .form-toggle {
        color: #666;
    }
    
    .form-toggle a {
        color: #6dd5ed;
        text-decoration: none;
        font-weight: 600;
    }
    
    .form-toggle a:hover {
        text-decoration: underline;
    }
    
    .user-header {
        background: rgba(40, 44, 52, 0.95);
        color: #e0e0e0;
        padding: 15px 20px;
        border-radius: 15px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    body.light-mode .user-header {
        background: #ffffff;
        color: #333;
        border: 1px solid #ddd;
    }
    
    .hidden {
        display: none !important;
    }

    /* View-only styles */
    .view-only .action-buttons,
    .view-only button:not(.close):not([onclick*="openImage"]):not([onclick*="closeImage"]) {
        display: none !important;
    }

    .view-only .project-header-buttons {
        display: none !important;
    }

    .view-only input,
    .view-only textarea,
    .view-only select {
        display: none !important;
    }

    .view-only h3:not([id*="report"]) {
        display: none !important;
    }

    /* Developer Info Footer */
    .developer-info {
        margin-top: 40px;
        text-align: center;
        font-size: 0.9rem;
        color: #888;
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        width: 100%;
    }
    
    body.light-mode .developer-info {
        color: #555;
        border-top: 1px solid #ccc;
    }
    
    .developer-info a {
        color: #6dd5ed;
        text-decoration: none;
        transition: color 0.3s;
    }
    
    .developer-info a:hover {
        color: #2193b0;
        text-decoration: underline;
    }

    /* Responsive Design */
    @media(max-width: 600px) and (orientation: portrait) {
        .container {
            padding: 25px 20px;
            border-radius: 12px;
        }
        
        h1 {
            font-size: 26px;
        }
        
        .user-header {
            flex-direction: column;
            text-align: center;
            gap: 10px;
        }
        
        .theme-toggle {
            top: 10px;
            left: 10px;
            font-size: 1.2rem;
        }
        
        .inline-buttons {
            flex-direction: column;
        }
        
        .inline-buttons button {
            width: 100%;
        }

        .project-header {
            flex-direction: column;
            align-items: stretch;
        }

        .project-header-buttons {
            justify-content: center;
        }

        input[type="text"], input[type="number"], input[type="email"], input[type="password"], 
        input[type="file"], select, textarea {
            padding: 8px 10px;
            font-size: 0.8rem;
        }
        
        button {
            padding: 10px;
            font-size: 0.9rem;
        }

        .btn-primary, .btn-secondary {
            padding: 10px 15px;
        }
    }

    @media (max-width: 768px) {
        .container {
            padding: 15px 10px;
            margin-top: 40px;
        }

        h1 {
            font-size: 22px;
        }

        h2, h3 {
            font-size: 18px;
        }

        input, select, textarea, button {
            font-size: 0.9rem;
            padding: 8px 10px;
        }

        table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }

        th, td {
            font-size: 0.85rem;
            padding: 6px;
        }

        .inline-buttons {
            flex-direction: column;
        }

        .inline-buttons button {
            width: 100%;
        }
    }

</style>
</head>

<body>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<div id="darkModeToggle" class="theme-toggle">
    <i class="fas fa-adjust"></i>
</div>

<!-- Authentication Page -->
<div class="auth-container" id="authPage">
    <div style="font-size: 3rem; margin-bottom: 1rem; color: #6dd5ed;">ğŸ“‹</div>
    <h1 id="form-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
    
    <div id="success-msg" class="success-message"></div>
    <div id="error-msg" class="error-message"></div>

    <form id="auth-form">
        <div class="form-group">
            <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
            <input type="email" id="email" name="email" placeholder="Your-Name@gmail.com" required>
        </div>

        <div class="form-group">
            <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
            <input type="password" id="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
            <a href="#" style="font-size: 0.9rem; color: #6dd5ed; text-decoration: underline; display: block; text-align: right; margin-top: 10px;" onclick="resetPassword(); return false;" id="forgot-password-link">Ù‡Ù„ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
        </div>

        <div class="form-group hidden" id="confirm-password-group">
            <label for="confirm-password">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
            <input type="password" id="confirm-password" name="confirm-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>

        <div class="button-group">
            <button type="button" id="login-btn" class="btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
            <button type="button" id="signup-btn" class="btn-primary hidden">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        </div>
    </form>

    <div class="form-toggle">
        <p id="toggle-text">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" id="toggle-link">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a></p>
    </div>
</div>

<!-- Main Application -->
<div class="container hidden" id="mainPage">
    <div class="user-header">
        <div>
            <h2 style="margin: 0;">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="user-display-name"></span>! ğŸ™‹â€â™‚ï¸</h2>
            <small id="user-display-email"></small>
        </div>
        <button id="logout-btn" class="btn-secondary" style="margin: 0; width: auto;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <!-- Projects List View -->
    <div id="projectsListView">
        <h2>ğŸ—ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
        
        <div style="text-align: center; margin: 20px 0;">
            <button id="showAddProjectBtn" onclick="toggleAddProject()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <!-- Add Project Section -->
        <div class="add-project-section" id="addProjectSection">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="newProjectName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button onclick="addProject()" style="flex: 1;">Ø¥Ø¶Ø§ÙØ©</button>
                <button onclick="toggleAddProject()" style="flex: 1; background: #666;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>

        <div id="projectsList"></div>
    </div>

    <!-- Project Details View -->
    <div id="projectDetailsView" class="hidden">
        <div class="project-header">
            <h2 id="currentProjectTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h2>
            <div class="project-header-buttons">
                <button class="back-btn" onclick="goBackToProjects()">
                    <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
                </button>
                <button class="share-btn" onclick="shareProject()">
                    <i class="fas fa-share"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                </button>
                <button class="delete" onclick="deleteCurrentProject()">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                </button>
            </div>
        </div>

        <div id="mainContent">
            <hr style="margin: 30px 0; border: 1px solid rgba(255,255,255,0.1);">
            <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„</h3>
            <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„">
            <input type="number" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            <input type="number" id="wage" placeholder="Ø§Ù„Ø£Ø¬Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©">
            <label for="imageFile">ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ù„:</label>
            <input type="file" id="imageFile" accept="image/*">
            <button onclick="addWorker()">Ø¥Ø¶Ø§ÙØ©</button>

            <h3>ğŸ“Š ÙƒØ´Ù Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ø£Ø¬Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…</th>
                        <th>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
                        <th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th>
                    </tr>
                </thead>
                <tbody id="workerTable"></tbody>
            </table>
     
            <div style="margin-top: 20px;">
                <h3>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                <input type="text" id="attendanceWorkerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„">
                <div class="inline-buttons">
                    <button onclick="markAttendanceByName('day')">Ø¥Ø¶Ø§ÙØ© ÙŠÙˆÙ…</button>
                    <button onclick="markAttendanceByName('half')">Ø¥Ø¶Ø§ÙØ© Ù†ØµÙ ÙŠÙˆÙ…</button>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <h3>ğŸ’° ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹</h3>
                <input type="text" id="payWorkerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„">
                <input type="number" id="payAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¯ÙØ¹Ù‡">
                <button onclick="payByWorkerName()">Ø¯ÙØ¹</button>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>ğŸ—“ï¸ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
                <input type="text" id="historyWorkerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª">
                <button onclick="showPaymentHistory()">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</button>
                <div id="paymentHistoryReport" style="margin-top:10px;"></div>
            </div>

            <h3>ğŸ“‘ Ø§Ù„Ø¬Ø±Ø¯</h3>
            <input type="text" id="reportWorkerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±">
            <button onclick="showReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            <button onclick="showAllReports()">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            
            <div id="report"></div>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="modal">
    <span class="close" onclick="closeImage()">&times;</span>
    <img class="modal-content" id="modalImage">
</div>

<!-- Share Modal -->
<div id="shareModal" class="share-modal">
    <div class="share-modal-content">
        <span class="close" onclick="closeShareModal()" style="position: absolute; top: 10px; right: 15px; font-size: 28px;">&times;</span>
        <h3 style="margin-top: 0;">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h3>
        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ø¯Ù†Ø§Ù‡ ÙˆÙ…Ø´Ø§Ø±ÙƒØªÙ‡ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</p>
        <div class="share-link" id="shareLink"></div>
        <button onclick="copyShareLink()" class="share-btn" style="margin: 10px 0; width: auto;">
            <i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
        </button>
        <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 15px;">
            Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø°ÙŠÙ† ÙŠÙØªØ­ÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø³ÙŠÙ…ÙƒÙ†Ù‡Ù… ÙÙ‚Ø· Ù…Ø´Ø§Ù‡Ø¯Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¯ÙˆÙ† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.
        </p>
    </div>
</div>

<div class="developer-info">
    <p>ØªØ·ÙˆÙŠØ±: Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ ÙƒØ§Ø¸Ù… Ù‚Ø§Ø³Ù…</p>
    <p>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: <a href="tel:07746424814">07746424814</a></p>
</div>

<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDye4DgqNvEwwWDYf1yjW5yfJc14p1LmiU",
        authDomain: "your-project-10fbe.firebaseapp.com",
        databaseURL: "https://your-project-10fbe-default-rtdb.firebaseio.com",
        projectId: "your-project-10fbe",
        storageBucket: "your-project-10fbe.firebasestorage.app",
        messagingSenderId: "715972050011",
        appId: "1:715972050011:web:d5a4507dcfc30fa779d37e",
        measurementId: "G-D1FRL391R4"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    
    // Global Variables
    let projects = [];
    let currentProject = null;
    let currentUser = null;
    let isViewOnly = false;
    
    // UI Elements
    const authPage = document.getElementById('authPage');
    const mainPage = document.getElementById('mainPage');
    const projectsListView = document.getElementById('projectsListView');
    const projectDetailsView = document.getElementById('projectDetailsView');
    const form = document.getElementById('auth-form');
    const formTitle = document.getElementById('form-title');
    const loginBtn = document.getElementById('login-btn');
    const signupBtn = document.getElementById('signup-btn');
    const toggleLink = document.getElementById('toggle-link');
    const toggleText = document.getElementById('toggle-text');
    const confirmPasswordGroup = document.getElementById('confirm-password-group');
    const successMsg = document.getElementById('success-msg');
    const errorMsg = document.getElementById('error-msg');
    const logoutBtn = document.getElementById('logout-btn');
    const userDisplayName = document.getElementById('user-display-name');
    const userDisplayEmail = document.getElementById('user-display-email');
    const forgotPasswordLink = document.getElementById('forgot-password-link');
    const mainContent = document.getElementById('mainContent');
    
    let isLoginMode = true;

    // Check URL parameters for shared project
    window.addEventListener('load', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const sharedProjectId = urlParams.get('project');
        const sharedUserId = urlParams.get('user');
        
        if (sharedProjectId && sharedUserId) {
            isViewOnly = true;
            loadSharedProject(sharedUserId, sharedProjectId);
        }
    });
    
    // Check for user login state
    auth.onAuthStateChanged(user => {
        if (user && !isViewOnly) {
            currentUser = user;
            showMainApp();
            loadProjects();
        } else if (!isViewOnly) {
            currentUser = null;
            hideAllPages();
            authPage.classList.remove('hidden');
        }
    });

    // Navigation Functions
    function showProjectsList() {
        projectsListView.classList.remove('hidden');
        projectDetailsView.classList.add('hidden');
        currentProject = null;
    }

    function showProjectDetails() {
        projectsListView.classList.add('hidden');
        projectDetailsView.classList.remove('hidden');
    }

    function goBackToProjects() {
        showProjectsList();
    }

    function toggleAddProject() {
        const section = document.getElementById('addProjectSection');
        const btn = document.getElementById('showAddProjectBtn');
        
        if (section.classList.contains('show')) {
            section.classList.remove('show');
            btn.innerHTML = 'â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('newProjectName').value = '';
        } else {
            section.classList.add('show');
            btn.innerHTML = 'âœ–ï¸ Ø¥Ù„ØºØ§Ø¡';
            document.getElementById('newProjectName').focus();
        }
    }

    // Message functions
    function showSuccess(message) {
        successMsg.textContent = message;
        successMsg.style.display = 'block';
        errorMsg.style.display = 'none';
        setTimeout(() => {
            successMsg.style.display = 'none';
        }, 3000);
    }

    function showError(message) {
        errorMsg.textContent = message;
        errorMsg.style.display = 'block';
        successMsg.style.display = 'none';
        setTimeout(() => {
            errorMsg.style.display = 'none';
        }, 3000);
    }
    
    // Auth functions
    function toggleMode() {
        isLoginMode = !isLoginMode;
        if (isLoginMode) {
            formTitle.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            loginBtn.classList.remove('hidden');
            signupBtn.classList.add('hidden');
            confirmPasswordGroup.classList.add('hidden');
            if (forgotPasswordLink) forgotPasswordLink.style.display = 'block';
            toggleText.innerHTML = 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" id="toggle-link">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>';
        } else {
            formTitle.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
            signupBtn.classList.remove('hidden');
            loginBtn.classList.add('hidden');
            confirmPasswordGroup.classList.remove('hidden');
            if (forgotPasswordLink) forgotPasswordLink.style.display = 'none';
            toggleText.innerHTML = 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" id="toggle-link">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>';
        }

        const newToggleLink = document.getElementById('toggle-link');
        if (newToggleLink) {
            newToggleLink.addEventListener('click', function(e) {
                e.preventDefault();
                toggleMode();
            });
        }
    }

    function login(email, password) {
        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
            })
            .catch((error) => {
                const errorMessage = error.message;
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.');
                console.error("Login error: ", errorMessage);
            });
    }

    function signup(email, password, confirmPassword) {
        if (password !== confirmPassword) {
            showError('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
            return false;
        }
        if (password.length < 6) {
            showError('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
            return false;
        }

        auth.createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                database.ref('users/' + user.uid).set({
                    email: email,
                    name: email.split('@')[0]
                }).then(() => {
                    showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                    setTimeout(() => {
                        toggleMode();
                        document.getElementById('email').value = email;
                    }, 1000);
                });
            })
            .catch((error) => {
                const errorMessage = error.message;
                if (errorMessage.includes("email-already-in-use")) {
                    showError('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
                } else {
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                }
                console.error("Signup error: ", errorMessage);
            });
    }

    function hideAllPages() {
        authPage.classList.add('hidden');
        mainPage.classList.add('hidden');
    }

    function showMainApp() {
        hideAllPages();
        mainPage.classList.remove('hidden');
        if (currentUser) {
            userDisplayName.textContent = currentUser.displayName || currentUser.email.split('@')[0];
            userDisplayEmail.textContent = currentUser.email;
        }
        showProjectsList();
    }

    function logout() {
        auth.signOut()
            .then(() => {
                showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
            })
            .catch((error) => {
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.');
                console.error("Logout error: ", error);
            });
    }

    function resetPassword() {
        const email = document.getElementById("email").value;
        if (email) {
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.");
                })
                .catch((error) => {
                    let errorMessage = "Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
                    if (error.code === "auth/user-not-found") {
                        errorMessage = "Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„.";
                    } else if (error.code === "auth/invalid-email") {
                        errorMessage = "ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
                    }
                    alert(errorMessage);
                    console.error("Password reset error:", error);
                });
        } else {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹.");
        }
    }

    // Load projects from Firebase
    function loadProjects() {
        if (!currentUser) return;
        const projectsRef = database.ref(`workmanProjects/${currentUser.uid}`);
        
        projectsRef.on('value', snapshot => {
            const data = snapshot.val();
            projects = [];
            if (data) {
                projects = Object.keys(data).map(key => ({
                    id: key,
                    ...data[key]
                }));
            }
            updateProjectList();
        });
    }

    // Load shared project
    function loadSharedProject(userId, projectId) {
        const projectRef = database.ref(`workmanProjects/${userId}/${projectId}`);
        
        projectRef.once('value', snapshot => {
            const data = snapshot.val();
            if (data) {
                currentProject = { id: projectId, ...data };
                
                // Show shared project view
                hideAllPages();
                mainPage.classList.remove('hidden');
                mainPage.classList.add('view-only');
                
                // Hide user header and show project directly
                document.querySelector('.user-header').style.display = 'none';
                projectsListView.classList.add('hidden');
                projectDetailsView.classList.remove('hidden');
                
                // Update project title
                document.getElementById('currentProjectTitle').textContent = `Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø´Ø±ÙˆØ¹: ${currentProject.name}`;
                
                // Show only reports
                showAllReports();
            } else {
                alert('Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ØªÙ… Ø­Ø°ÙÙ‡.');
            }
        }).catch(error => {
            console.error('Error loading shared project:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.');
        });
    }

    // Save project data to Firebase
    function saveProject(projectData) {
        return new Promise((resolve, reject) => {
            if (!currentUser) {
                showError("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
                return reject("No user logged in.");
            }
            const projectsRef = database.ref(`workmanProjects/${currentUser.uid}`);
            
            if (projectData.id) {
                const projectId = projectData.id;
                delete projectData.id;
                projectsRef.child(projectId).update(projectData).then(() => {
                    showSuccess("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!");
                    resolve();
                }).catch(error => {
                    console.error("Error updating project: ", error);
                    showError("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.");
                    reject(error);
                });
            } else {
                projectsRef.push(projectData).then(() => {
                    showSuccess("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!");
                    resolve();
                }).catch(error => {
                    console.error("Error adding new project: ", error);
                    showError("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.");
                    reject(error);
                });
            }
        });
    }

    function formatNumber(num) {
        return num.toLocaleString('ar-EG');
    }

    // Project Management Functions
    function addProject() {
        let projectName = document.getElementById("newProjectName").value.trim();
        if (projectName) {
            const newProject = {
                name: projectName, 
                workers: []
            };
            saveProject(newProject).then(() => {
                document.getElementById("newProjectName").value = "";
                toggleAddProject(); // Hide the add form
            });
        } else {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.");
        }
    }

    function updateProjectList() {
        const listDiv = document.getElementById("projectsList");
        listDiv.innerHTML = "";

        if (projects.length === 0) {
            listDiv.innerHTML = "<p style='text-align: center; opacity: 0.7; margin: 40px 0;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ 'Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯' Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø£ÙˆÙ„.</p>";
            return;
        }

        projects.forEach(p => {
            // Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„ÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹
            let totalRemaining = 0;
            let workersCount = 0;
            if (p.workers) {
                workersCount = p.workers.length;
                p.workers.forEach(w => {
                    let totalDue = (w.days || 0) * (w.wage || 0);
                    let totalPaid = (w.payments || []).reduce((sum, pay) => sum + pay.amount, 0);
                    totalRemaining += (totalDue - totalPaid);
                });
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
            let card = document.createElement("div");
            card.className = "project-card";
            card.innerHTML = `
                <h3>${p.name}</h3>
                <div class="project-info">
                    <div><i class="fas fa-users"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„: ${workersCount}</div>
                    <div><i class="fas fa-money-bill-wave"></i> Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${formatNumber(totalRemaining)}</div>
                </div>
            `;

            card.onclick = () => openProject(p.id);
            listDiv.appendChild(card);
        });
    }

    // Open project details
    function openProject(projectId) {
        currentProject = projects.find(p => p.id === projectId);
        if (currentProject) {
            document.getElementById('currentProjectTitle').textContent = `Ù…Ø´Ø±ÙˆØ¹: ${currentProject.name}`;
            showProjectDetails();
            updateTable();
        }
    }

    // Delete current project
    function deleteCurrentProject() {
        if (!currentProject) {
            alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø±ÙˆØ¹ Ù…Ø­Ø¯Ø¯ Ù„Ø­Ø°ÙÙ‡.");
            return;
        }

        const projectName = currentProject.name;
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "${projectName}"ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
            const projectRef = database.ref(`workmanProjects/${currentUser.uid}/${currentProject.id}`);
            projectRef.remove().then(() => {
                showSuccess(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "${projectName}" Ø¨Ù†Ø¬Ø§Ø­!`);
                goBackToProjects();
            }).catch(error => {
                showError("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.");
                console.error("Error deleting project:", error);
            });
        }
    }

    // Share project
    function shareProject() {
        if (!currentProject) {
            alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø±ÙˆØ¹ Ù…Ø­Ø¯Ø¯ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©.");
            return;
        }

        const shareUrl = `${window.location.origin}${window.location.pathname}?user=${currentUser.uid}&project=${currentProject.id}`;
        document.getElementById('shareLink').textContent = shareUrl;
        document.getElementById('shareModal').style.display = 'block';
    }

    function closeShareModal() {
        document.getElementById('shareModal').style.display = 'none';
    }

    function copyShareLink() {
        const shareLink = document.getElementById('shareLink');
        const text = shareLink.textContent;
        
        // Create temporary textarea element
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        
        // Show feedback
        alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.');
    }

    function getWorkers() {
        return currentProject ? currentProject.workers || [] : [];
    }
    
    // Attendance Functions
    function markAttendanceByName(type) {
        let nameToFind = document.getElementById("attendanceWorkerName").value.trim();
        let workers = getWorkers();

        if (!nameToFind) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„.");
            return;
        }

        let workerFound = false;
        workers.forEach(w => {
            if (w.name === nameToFind) {
                let today = new Date().toLocaleDateString("ar-EG");
                let value = (type === "day") ? 1 : 0.5;
                w.days += value;
                if (!w.attendance) w.attendance = [];
                w.attendance.push({ date: today, value: value });
                workerFound = true;
            }
        });
        if (workerFound) {
            currentProject.workers = workers;
            saveProject(currentProject).then(() => {
                updateTable();
                document.getElementById("attendanceWorkerName").value = "";
            });
        } else {
            alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø§Ù…Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.");
        }
    }

    // Worker Management Functions
    function addWorker() {
        if (!currentProject) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹.");
            return;
        }

        let name = document.getElementById("name").value.trim();
        let phone = parseFloat(document.getElementById("phone").value);
        let wage = parseFloat(document.getElementById("wage").value);
        let imageFile = document.getElementById("imageFile").files[0];

        if(name && phone && wage) {
            if(imageFile) {
                let reader = new FileReader();
                reader.onload = function(e) {
                    if (!currentProject.workers) currentProject.workers = [];
                    currentProject.workers.push({
                        name: name, 
                        phone: phone, 
                        wage: wage, 
                        days: 0, 
                        attendance: [], 
                        payments: [], 
                        image: e.target.result
                    });
                    saveProject(currentProject).then(() => {
                        updateTable();
                        resetInputs();
                    });
                };
                reader.readAsDataURL(imageFile);
            } else {
                if (!currentProject.workers) currentProject.workers = [];
                currentProject.workers.push({
                    name: name, 
                    phone: phone, 
                    wage: wage, 
                    days: 0, 
                    attendance: [], 
                    payments: [], 
                    image: 'https://via.placeholder.com/50'
                });
                saveProject(currentProject).then(() => {
                    updateTable();
                    resetInputs();
                });
            }
        } else {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ØŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙØŒ ÙˆØ§Ù„Ø£Ø¬Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©");
        }
    }
    
    function resetInputs() {
        document.getElementById("name").value = "";
        document.getElementById("phone").value = "";
        document.getElementById("wage").value = "";
        document.getElementById("imageFile").value = "";
    }

    function payByWorkerName() {
        let nameToFind = document.getElementById("payWorkerName").value.trim();
        let amountToPay = parseFloat(document.getElementById("payAmount").value);
        let workers = getWorkers();
        
        if (!nameToFind || !amountToPay || isNaN(amountToPay) || amountToPay <= 0) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ØµØ­ÙŠØ­.");
            return;
        }

        let workerFound = false;
        workers.forEach(w => {
            if (w.name === nameToFind) {
                if (!w.payments) w.payments = [];
                w.payments.push({
                    amount: amountToPay,
                    date: new Date().toLocaleString("ar-EG")
                });
                workerFound = true;
            }
        });
        if (workerFound) {
            currentProject.workers = workers;
            saveProject(currentProject).then(() => {
                updateTable();
                document.getElementById("payWorkerName").value = "";
                document.getElementById("payAmount").value = "";
            });
        } else {
            alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø§Ù…Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.");
        }
    }

    function showPaymentHistory() {
        let historyDiv = document.getElementById("paymentHistoryReport");
        let nameToFind = document.getElementById("historyWorkerName").value.trim();
        let workers = getWorkers();
        historyDiv.innerHTML = "";

        let worker = workers.find(w => w.name === nameToFind);
        if (worker) {
            if (worker.payments && worker.payments.length > 0) {
                let reportHTML = `<h4>Ø³Ø¬Ù„ Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„: ${worker.name}</h4><ul>`;
                worker.payments.forEach(p => {
                    reportHTML += `<li>Ù…Ø¨Ù„Øº: ${formatNumber(p.amount)} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${p.date}</li>`;
                });
                reportHTML += `</ul>`;
                historyDiv.innerHTML = reportHTML;
            } else {
                historyDiv.innerHTML = `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„.</p>`;
            }
        } else {
            historyDiv.innerHTML = `<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø§Ù…Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….</p>`;
        }
    }

    function deleteWorker(index) {
        let workers = getWorkers();
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ØŸ")) {
            workers.splice(index, 1);
            currentProject.workers = workers;
            saveProject(currentProject).then(() => {
                updateTable();
            });
        }
    }

    function updateTable() {
        let table = document.getElementById("workerTable");
        let workers = getWorkers();
        table.innerHTML = "";
        workers.forEach((w, i) => {
            let totalDue = w.days * w.wage;
            let row = `<tr>
                <td>${w.name}</td>
                <td>${formatNumber(w.wage)}</td>
                <td>${w.days}</td>
                <td>${formatNumber(totalDue)}</td>
                <td class="action-buttons">
                    <button onclick="deleteWorker(${i})" class="delete">Ø­Ø°Ù</button>
                </td>
            </tr>`;
            table.innerHTML += row;
        });
    }

    function showReport() {
        let reportDiv = document.getElementById("report");
        reportDiv.innerHTML = "";
        let nameToFind = document.getElementById("reportWorkerName").value.trim();
        let workers = getWorkers();
        if (nameToFind) {
            let worker = workers.find(w => w.name === nameToFind);
            if (worker) {
                let totalDue = worker.days * worker.wage;
                let totalPaid = (worker.payments || []).reduce((sum, p) => sum + p.amount, 0);
                let remaining = totalDue - totalPaid;
                let attList = (worker.attendance || []).map(a => `${a.date} (${a.value} ÙŠÙˆÙ…)`).join("<br>");
                let card = `<div class="report">
                    <div class="worker-details">
                        <img src="${worker.image || 'https://via.placeholder.com/50'}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ù„" class="worker-image" onclick="openImage('${worker.image || 'https://via.placeholder.com/700'}')">
                        <b>${worker.name}</b>
                    </div>
                    <br>
                    ğŸ“ ${worker.phone}<br>
                    ğŸ’° Ø£Ø¬Ø±Ø© ÙŠÙˆÙ…ÙŠØ©: ${formatNumber(worker.wage)}<br>
                    ğŸ“… Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: ${worker.days}<br>
                    ğŸ§¾ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø³ØªØ­Ù‚: ${formatNumber(totalDue)}<br>
                    ğŸ’µ Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${formatNumber(totalPaid)}<br>
                    âš–ï¸ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatNumber(remaining)}<br>
                    ğŸ—“ï¸ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¶ÙˆØ±:<br> ${attList || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¶ÙˆØ± Ù…Ø³Ø¬Ù„"}
                </div>`;
                reportDiv.innerHTML = card;
            } else {
                reportDiv.innerHTML = `<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø§Ù…Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.</p>`;
            }
        } else {
            showAllReports();
        }
    }
    
    function showAllReports() {
        let reportDiv = document.getElementById("report");
        let workers = getWorkers();
        reportDiv.innerHTML = "";
        
        if (workers.length === 0) {
            reportDiv.innerHTML = "<p style='text-align: center; opacity: 0.7;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ø§Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.</p>";
            return;
        }

        workers.forEach((w, i) => {
            let totalDue = w.days * w.wage;
            let totalPaid = (w.payments || []).reduce((sum, p) => sum + p.amount, 0);
            let remaining = totalDue - totalPaid;
            let attList = (w.attendance || []).map(a => `${a.date} (${a.value} ÙŠÙˆÙ…)`).join("<br>");
            
            let card = `<div class="report">
                <div class="worker-details">
                    <img src="${w.image || 'https://via.placeholder.com/50'}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ù„" class="worker-image" onclick="openImage('${w.image || 'https://via.placeholder.com/700'}')">
                    <b>${i+1} - ${w.name}</b>
                </div>
                <br>
                ğŸ“ ${w.phone}<br>
                ğŸ’° Ø£Ø¬Ø±Ø© ÙŠÙˆÙ…ÙŠØ©: ${formatNumber(w.wage)}<br>
                ğŸ“… Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: ${w.days}<br>
                ğŸ§¾ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø³ØªØ­Ù‚: ${formatNumber(totalDue)}<br>
                ğŸ’µ Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${formatNumber(totalPaid)}<br>
                âš–ï¸ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatNumber(remaining)}<br>
                ğŸ—“ï¸ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¶ÙˆØ±:<br> ${attList || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¶ÙˆØ± Ù…Ø³Ø¬Ù„"}
            </div>`;
            reportDiv.innerHTML += card;
        });
    }

    // Modal functions
    function openImage(imageSrc) {
        let modal = document.getElementById("imageModal");
        let modalImg = document.getElementById("modalImage");
        modal.style.display = "block";
        modalImg.src = imageSrc;
    }

    function closeImage() {
        let modal = document.getElementById("imageModal");
        modal.style.display = "none";
    }

    // Auth Event Listeners
    if (loginBtn) {
        loginBtn.addEventListener('click', function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            if (!email || !password) {
                showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            login(email, password);
        });
    }

    if (signupBtn) {
        signupBtn.addEventListener('click', function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            if (!email || !password) {
                showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            if (!isLoginMode && !confirmPassword) {
                showError('ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }
            signup(email, password, confirmPassword);
        });
    }

    if (toggleLink) {
        toggleLink.addEventListener('click', function(e) {
            e.preventDefault();
            toggleMode();
        });
    }

    if (logoutBtn) {
        logoutBtn.addEventListener('click', logout);
    }

    if (form) {
        form.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (isLoginMode) {
                    loginBtn.click();
                } else {
                    signupBtn.click();
                }
            }
        });
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
        const imageModal = document.getElementById('imageModal');
        const shareModal = document.getElementById('shareModal');
        
        if (event.target == imageModal) {
            closeImage();
        }
        if (event.target == shareModal) {
            closeShareModal();
        }
    }

    // Dark Mode Toggle
    document.addEventListener('DOMContentLoaded', (event) => {
        const darkModeToggle = document.getElementById('darkModeToggle');
        const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");

        const currentTheme = localStorage.getItem("theme");
        if (currentTheme === "dark") {
            document.body.classList.add("light-mode");
        } else if (currentTheme === "light") {
            document.body.classList.remove("light-mode");
        } else if (prefersDarkScheme.matches) {
            document.body.classList.remove("light-mode");
        } else {
            document.body.classList.add("light-mode");
        }
        
        function updateDarkModeIcon() {
            if (document.body.classList.contains("light-mode")) {
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }
        
        updateDarkModeIcon();
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle("light-mode");
            if (document.body.classList.contains("light-mode")) {
                localStorage.setItem("theme", "dark");
            } else {
                localStorage.setItem("theme", "light");
            }
            updateDarkModeIcon();
        });
    });

</script>

</body>
</html>
